---
title: ' '
author: ' '
date: ' '
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Derived Factors $\mathfrak{f}_{t,DNN}^{(n),h}$ for \textbf{DNN 2} Generated Using the Set of Yields

```{r, warning=FALSE, message=FALSE, echo=FALSE}

library(data.table)
library(readxl)
library(tidyr)
library(tibble)
library(dplyr)
library(ggplot2)
library(lubridate)
library(zoo)       # For time series [using only as.Date() & as.yearmon()]
library(ggthemes)
library(magrittr)  # To use different pipe operators

library("tidyquant")
library("tis")
library("egg")
library("latex2exp")
library("plotly")

load("C:/Users/caioa/OneDrive - The University of Kansas/Documents/PhD/13. WPs/11. GANs, AGMM - Forecasting Bonds, GDP, Unemployment/02. Empirical/06.RData/2020.09.24_my_data.RData")

independ_var_datasets_names <- c("forward_monthly_matrix_spread", "y_monthly_matrix_spread", "y_monthly_matrix_spread_forward_monthly_matrix_spread") 
maturity_list <- c('rx_monthly_2', 'rx_monthly_3', 'rx_monthly_4', 'rx_monthly_5', "rx_monthly_avg_2_3_4_5")

my_data %>% 
  select("t", "model", "independ_var_datasets", "my_factor", "lat_fact_NN_rx_monthly_2y_matur", "lat_fact_NN_rx_monthly_3y_matur", "lat_fact_NN_rx_monthly_4y_matur", "lat_fact_NN_rx_monthly_5y_matur") %>%
  # select("t", "model", "independ_var_datasets", "my_factor", "residuals_rx_monthly_2y_matur", "residuals_rx_monthly_3y_matur", "residuals_rx_monthly_4y_matur", "residuals_rx_monthly_5y_matur") %>% 
  filter(model=='NN_model_2', independ_var_datasets==independ_var_datasets_names[2]) %>% 
  select(-"t", -"model", -"independ_var_datasets", -"my_factor") %>%
  as.ts() %>% 
  data.matrix() %>%
  t() %>%
    plot_ly(
      x=as.Date(unique(my_data$t)),
      y=c(2,3,4,5),
      z=.,
      type="surface",
      opacity = .8
      # group=pull(select(A,my_factor)),
      # type = "scatter3d", 
      # mode = "markers",
      # mode = "lines",
      # line = list(width = 6, color = ~c, colorscale = 'Viridis')
    ) %>% 
  plotly::layout(
    title = "", 
    scene = list(
      camera = list(eye = list(x = 1.5, y = -1.5, z = 0.45)),
      aspectratio = list(x = 2, y = 1, z = 1.2),
      xaxis=list(title="Date"),
      yaxis=list(title="Maturity"),
      zaxis=list(title="DNN factors")
    )
  ) 
```

The figure above shows a 3D representation of $\mathfrak{f}_{t,DNN}^{(n),h}$ generated by the MLP architecture \textbf{DNN 2} using the set of yields $\boldsymbol{Z}_t^{\text{y}} = \left\lbrace y_t^{(1/12)}, y_t^{(2/12)}, \ldots, y_t^{(60/12)} \right\rbrace$ in terms of maturity for the period of analysis. \textbf{DNN 2} is a feedfoward neural networks architecture with 2 hidden layers ($L=2$), with $16$ and $4$ nodes respectively, and an output layer for each group of maturity $n \in \left\lbrace 2,3,4,5 \right\rbrace$. Period of analysis ranges from 1993:01 to 2017:12.
